https://www.rabbitmq.com/uri-query-parameters.html

amqps://myhost?cacertfile=/path/to/ca_certificate.pem
  &certfile=/path/to/client_certificate.pem
  &keyfile=/path/to/client_key.pem
  &verify=verify_peer
  &server_name_indication=myhost

Only of use for the amqps scheme and used to configure verification of the server's x509 (TLS) certificate. Note: 
It is highly recommended to use both values. See the TLS guide to learn more about TLS support in RabbitMQ in general and specifically the Erlang client section.


https://www.erlang.org/doc/man/ssl.html


https://www.erlang.org/doc/apps/ssl/ssl_distribution.html

1 Test SNI on VM1 = Check CN on server certificate on VM2, use that string on VM1 =

{server_name_indication,disable},
{server_name_indication,"xx.xx.xx.xx"},

Update VM2 to use SNI = hostname
{server_name_indication,disable},
{server_name_indication,"pdp-shovel-2"},

2022-02-16 19:22:42.386000+00:00 [notice] <0.1000.0> TLS client: In state wait_cert at ssl_handshake.erl:2017 generated CLIENT ALERT: Fatal - Handshake Failure
2022-02-16 19:22:57.463000+00:00 [notice] <0.1115.0>  - {bad_cert,hostname_check_failed}

Not working, set back to disable and shvel with amqps is running.

3 Test encode password for certfile = view 2_test_encode

3 
https://github.com/rabbitmq/rabbitmq-auth-mechanism-ssl/blob/v3.7.x/README.md

This plugin allows RabbitMQ clients authenticate using x509 certificates and TLS (PKI) peer verification mechanism 
instead of credentials (username/password pairs).



2 OpenSSL client certificate
2.1 Move OpenSSL to VM1 generate CA TestCA2 and client sertificate
2.2:
* Use new client certficate on vm1
* Copy client CA to vm2, since VM1 has server CA, {ssl_options, [{cacertfile,"C:\\testca\\ca_certificate.pem"},
* Set up client equal to server
# mtls

2 OpenSSL server certificate lasting just 1 day
# check connction after expired



2 Read on shovel properties, view 37 server

https://github.com/rabbitmq/rabbitmq-server/blob/master/deps/rabbit/docs/advanced.config.example

%% Rather than specifying some values per-shovel, you can specify
   %% them for all shovels here.
